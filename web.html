<!DOCTYPE html>
<html>
    <head>
      
        
          
     </head>
     
<body bgcolor="#FFFFFF">
<!--
<div id = "sse">
    <a href = "javascript:WebSocketTest()">Run WebSocket</a>
</div>
-->
<h1>Zzzzz...</h1>

<!--p>my name is eddie and im here to party down</p-->

<p id="connection_status"></p>

<p id="last_msg">üêà</p>

<p id="send_count">?</p>

<p id="demo">üêï</p>


<script>
       var ws_test = WebSocketTest();


       function WebSocketTest() {
            var ws;
            var reconnect = 0;   
            var periodicReq;     
          
            if ("WebSocket" in window) {
                // Attempt to connect
                ws = new WebSocket("ws://localhost:9998/derp");

                //var retryConnection;
                ws.onerror = function() {
                    if (reconnect == 0) {
                        reconnect = setTimeout(connectRetry, 500);
                    }
                }

                function connectRetry() {
                    console.log("retryin'");
                    if (ws.readyState === ws.OPEN || ws.readyState === ws.CONNECTING) {
                        ws.close();
                    }
                    clearTimeout(reconnect);
                    reconnect = 0;
                    WebSocketTest();
                }
          
                ws.onopen = function() {
                   document.getElementById("connection_status").innerHTML = "connected";
                   document.getElementById("send_count").innerHTML = "0";
                   periodicReq = setInterval(reqFromServer, 1000);
                   clearTimeout(reconnect);
                   console.log("opened");
                };

                function reqFromServer() {
                    ws.send("doesn't matter, really");
                    var count = parseInt(document.getElementById("send_count").innerHTML, 10);
                    count += 1;
                    document.getElementById("send_count").innerHTML = count.toString(10);
                }
             
                ws.onmessage = function(evt) { 
                   var received_msg = evt.data;
                   //alert(received_msg);
                   document.getElementById("last_msg").innerHTML = received_msg.toString(10);
                };

                ws.onclose = function() { 
                
                   // websocket is closed.
                   //alert("Connection is closed..."); 
                   document.getElementById("connection_status").innerHTML = "disconnected";
                   clearInterval(periodicReq);
                   if (reconnect == 0) {
                        reconnect = setTimeout(connectRetry, 500);
                    }

                };
            } else {
            
                // The browser doesn't support WebSocket
                alert("WebSocket NOT supported by your Browser!");
          }
       }
    </script>

<script>
var myVar = setInterval(myTimer, 1000);

function myTimer() {
  var d = new Date();
  document.getElementById("demo").innerHTML = d.toLocaleTimeString();
}
</script>



</body>
</html>


